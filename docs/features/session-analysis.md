# ì„¸ì…˜ ë¶„ì„ ê¸°ëŠ¥ (Session Analysis)

## ê°œìš”

ì„¸ì…˜ ë¶„ì„ ê¸°ëŠ¥ì€ Claude CLI ì„¸ì…˜ ë¡œê·¸ì—ì„œ ì‚¬ìš©ìê°€ ì§ì ‘ ì…ë ¥í•œ ì§ˆë¬¸ê³¼ Claudeê°€ ë‚´ë¶€ì ìœ¼ë¡œ ìƒì„±í•œ ìš”ì²­ì„ ë¶„ë¦¬í•˜ì—¬ ë¶„ì„í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì‹¤ì œ ì‚¬ìš©ì ì˜ë„ì™€ ìë™í™”ëœ ì›Œí¬í”Œë¡œìš°ë¥¼ ëª…í™•í•˜ê²Œ êµ¬ë¶„í•˜ì—¬ ì´í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì£¼ìš” ê¸°ëŠ¥

### 1. ì‚¬ìš©ì ì§ˆë¬¸ í•„í„°ë§ (User Questions)

ì„¸ì…˜ ë¡œê·¸ì—ì„œ ìˆœìˆ˜í•œ ì‚¬ìš©ì ì§ˆë¬¸ë§Œ ì¶”ì¶œí•©ë‹ˆë‹¤.

**í•„í„°ë§ ëŒ€ìƒ (ì œì™¸ë¨)**:
- Tool result (`[{"tool_use_id"...}`)
- System messages (`Caveat:...`)
- Command messages (`<command-name>`, `<command-message>`)
- Empty stdout (`<local-command-stdout></local-command-stdout>`)

**ê²°ê³¼**: ì‚¬ìš©ìê°€ ì§ì ‘ ì…ë ¥í•œ ì§ˆë¬¸ë§Œ í‘œì‹œ

### 2. ìë™ ìƒì„± ìš”ì²­ í•„í„°ë§ (Auto-Generated Requests)

Claudeê°€ ë‚´ë¶€ì ìœ¼ë¡œ ìƒì„±í•œ ìš”ì²­(sidechain)ë§Œ ì¶”ì¶œí•©ë‹ˆë‹¤.

**í•„í„°ë§ ê¸°ì¤€**:
- `isSidechain === true` ì†ì„±ì„ ê°€ì§„ ì´ë²¤íŠ¸

**ê²°ê³¼**: Task ì—ì´ì „íŠ¸ ë“± ìë™í™”ëœ í”„ë¡œì„¸ìŠ¤ì˜ ìš”ì²­ë§Œ í‘œì‹œ

### 3. íƒ­ ê¸°ë°˜ UI

ë‘ ê°€ì§€ ë·°ë¥¼ ì‰½ê²Œ ì „í™˜í•  ìˆ˜ ìˆëŠ” íƒ­ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

## ì‚¬ìš© ë°©ë²•

### 1. ì„¸ì…˜ ëª©ë¡ì—ì„œ ì ‘ê·¼

```
Claude Projects â†’ í”„ë¡œì íŠ¸ ì„ íƒ â†’ ì„¸ì…˜ ëª©ë¡
```

ê° ì„¸ì…˜ ì¹´ë“œì— "ğŸ“Š View Analysis" ë²„íŠ¼ì´ í‘œì‹œë©ë‹ˆë‹¤.

### 2. ì„¸ì…˜ ìƒì„¸ í˜ì´ì§€ì—ì„œ ì ‘ê·¼

```
ì„¸ì…˜ ìƒì„¸ í˜ì´ì§€ â†’ View Analysis ë²„íŠ¼ í´ë¦­
```

ì„¸ì…˜ ë¡œê·¸ ë·°ì–´ ìƒë‹¨ì˜ "View Analysis" ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.

### 3. ë¶„ì„ í˜ì´ì§€ ì‚¬ìš©

**User Questions íƒ­**:
- ì‚¬ìš©ìê°€ ì§ì ‘ ì…ë ¥í•œ ì§ˆë¬¸ë§Œ í‘œì‹œ
- ì‹¤ì œ ì‚¬ìš©ì ì˜ë„ íŒŒì•…ì— ìœ ìš©

**Auto-Generated Requests íƒ­**:
- Claudeê°€ ë‚´ë¶€ì ìœ¼ë¡œ ìƒì„±í•œ ìš”ì²­ë§Œ í‘œì‹œ
- ìë™í™”ëœ ì›Œí¬í”Œë¡œìš° ì´í•´ì— ìœ ìš©

**ì»¨íŠ¸ë¡¤**:
- **Back to Full Session**: ì „ì²´ ì„¸ì…˜ ë¡œê·¸ë¡œ ëŒì•„ê°€ê¸°
- **Refresh**: ë°ì´í„° ìƒˆë¡œê³ ì¹¨
- **Close**: ì„¸ì…˜ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°

## ê¸°ìˆ  êµ¬í˜„

### Backend (Services)

**íŒŒì¼**: `src/services/claudeSessions.ts`

```typescript
// ì‚¬ìš©ì ì§ˆë¬¸ í•„í„°ë§
export const getUserQuestions = (
  projectPath: string,
  sessionId: string
): ClaudeSessionEntry[]

// ìë™ ìƒì„± ìš”ì²­ í•„í„°ë§
export const getAutoGeneratedRequests = (
  projectPath: string,
  sessionId: string
): ClaudeSessionEntry[]
```

### IPC Layer

**íŒŒì¼**: `src/ipc/handlers/claudeSessionsHandlers.ts`

**ì±„ë„**:
- `claude-sessions:get-user-questions`
- `claude-sessions:get-auto-generated-requests`
- `claude-sessions:get-session-analysis`

### Frontend (React)

**í˜ì´ì§€**: `src/pages/ClaudeSessionAnalysisPage.tsx`

**ë¼ìš°íŒ…**: `/claude-projects/:projectDirName/sessions/:sessionId/analysis`

**ì£¼ìš” ì»´í¬ë„ŒíŠ¸**:
- íƒ­ ê¸°ë°˜ ë·° ì „í™˜
- ì‹¤ì‹œê°„ ë°ì´í„° ë¡œë”©
- ì—ëŸ¬ í•¸ë“¤ë§

### API íƒ€ì…

**íŒŒì¼**: `src/types/api/sessions.ts`

```typescript
export interface SessionAnalysisData {
  userQuestions: ClaudeSessionEntry[];
  autoGeneratedRequests: ClaudeSessionEntry[];
}

export interface ClaudeSessionsAPI {
  // ... ê¸°ì¡´ API
  getSessionAnalysis: (
    projectPath: string,
    sessionId: string
  ) => Promise<SessionAnalysisData>;

  getUserQuestions: (
    projectPath: string,
    sessionId: string
  ) => Promise<ClaudeSessionEntry[]>;

  getAutoGeneratedRequests: (
    projectPath: string,
    sessionId: string
  ) => Promise<ClaudeSessionEntry[]>;
}
```

## ë°ì´í„° íë¦„

```
1. User clicks "View Analysis"
   â†“
2. Navigate to /claude-projects/:projectDirName/sessions/:sessionId/analysis
   â†“
3. ClaudeSessionAnalysisPage loads
   â†“
4. Parallel API calls:
   - getUserQuestions(projectPath, sessionId)
   - getAutoGeneratedRequests(projectPath, sessionId)
   â†“
5. IPC: claude-sessions:get-user-questions
   IPC: claude-sessions:get-auto-generated-requests
   â†“
6. Backend filters session log entries
   â†“
7. Return filtered data to frontend
   â†“
8. Display in tabbed UI
```

## í™œìš© ì‚¬ë¡€

### 1. ì‹¤ì œ ì‚¬ìš©ì ì˜ë„ íŒŒì•…

**ì‹œë‚˜ë¦¬ì˜¤**: ì„¸ì…˜ì´ ê¸¸ì–´ì ¸ì„œ ì‹¤ì œ ì‚¬ìš©ìê°€ ë¬´ì—‡ì„ ìš”ì²­í–ˆëŠ”ì§€ íŒŒì•…í•˜ê¸° ì–´ë ¤ìš´ ê²½ìš°

**í•´ê²°**: User Questions íƒ­ì—ì„œ ìˆœìˆ˜í•œ ì‚¬ìš©ì ì§ˆë¬¸ë§Œ í™•ì¸

### 2. ìë™í™” ì›Œí¬í”Œë¡œìš° ë¶„ì„

**ì‹œë‚˜ë¦¬ì˜¤**: Task ì—ì´ì „íŠ¸ê°€ ë‚´ë¶€ì ìœ¼ë¡œ ì–´ë–¤ ì‘ì—…ì„ ìˆ˜í–‰í–ˆëŠ”ì§€ í™•ì¸

**í•´ê²°**: Auto-Generated Requests íƒ­ì—ì„œ ìë™ ìƒì„±ëœ ìš”ì²­ ì¶”ì 

### 3. ë””ë²„ê¹…

**ì‹œë‚˜ë¦¬ì˜¤**: ì„¸ì…˜ì—ì„œ ì˜ˆìƒê³¼ ë‹¤ë¥¸ ë™ì‘ì´ ë°œìƒí•œ ê²½ìš°

**í•´ê²°**: ì‚¬ìš©ì ì§ˆë¬¸ê³¼ ìë™ ìš”ì²­ì„ ë¶„ë¦¬í•˜ì—¬ ë¬¸ì œ ì›ì¸ íŒŒì•…

### 4. ì‚¬ìš© íŒ¨í„´ ë¶„ì„

**ì‹œë‚˜ë¦¬ì˜¤**: í”„ë¡œì íŠ¸ì—ì„œ ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ ìœ í˜• íŒŒì•…

**í•´ê²°**: ì—¬ëŸ¬ ì„¸ì…˜ì˜ User Questionsë¥¼ ë¹„êµ ë¶„ì„

## ì œí•œì‚¬í•­

1. **ì •ì  ë¶„ì„**: ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ì¤‘ì—ëŠ” ì‚¬ìš© ë¶ˆê°€ (ì €ì¥ëœ ì„¸ì…˜ë§Œ ë¶„ì„)
2. **êµ¬ì¡°í™”ëœ ì»¨í…ì¸ **: ë¬¸ìì—´ í˜•íƒœì˜ ë©”ì‹œì§€ë§Œ ì²˜ë¦¬ (ë°°ì—´ ë“± ë³µì¡í•œ êµ¬ì¡°ëŠ” ì œì™¸)
3. **ë©”íƒ€ë°ì´í„° ì˜ì¡´**: `isSidechain` í•„ë“œê°€ ì—†ëŠ” êµ¬ ë²„ì „ ì„¸ì…˜ì€ auto-generated í•„í„°ë§ ë¶ˆê°€

## í–¥í›„ ê°œì„  ë°©í–¥

- [ ] ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ë¶„ì„ ì§€ì›
- [ ] í†µê³„ ëŒ€ì‹œë³´ë“œ (ì§ˆë¬¸ ìœ í˜•ë³„ ë¶„í¬, ì‹œê°„ëŒ€ë³„ íŒ¨í„´ ë“±)
- [ ] ì„¸ì…˜ ê°„ ë¹„êµ ë¶„ì„
- [ ] í‚¤ì›Œë“œ ê¸°ë°˜ ê²€ìƒ‰ ë° í•„í„°ë§
- [ ] Export ê¸°ëŠ¥ (CSV, JSON)
- [ ] ì‹œê°í™” ì°¨íŠ¸ (íƒ€ì„ë¼ì¸, íˆìŠ¤í† ê·¸ë¨ ë“±)

## ê´€ë ¨ íŒŒì¼

### í•µì‹¬ íŒŒì¼
- `src/services/claudeSessions.ts` - í•„í„°ë§ ë¡œì§
- `src/pages/ClaudeSessionAnalysisPage.tsx` - ë¶„ì„ í˜ì´ì§€
- `src/ipc/handlers/claudeSessionsHandlers.ts` - IPC í•¸ë“¤ëŸ¬
- `src/types/api/sessions.ts` - íƒ€ì… ì •ì˜

### ê´€ë ¨ ì»´í¬ë„ŒíŠ¸
- `src/components/sessions/SessionLogViewer.tsx` - ì„¸ì…˜ ë·°ì–´ (ë¶„ì„ ë²„íŠ¼ ì¶”ê°€)
- `src/pages/ClaudeSessionsListPage.tsx` - ì„¸ì…˜ ëª©ë¡ (ë¶„ì„ ë²„íŠ¼ ì¶”ê°€)
- `src/pages/ClaudeSessionDetailPage.tsx` - ì„¸ì…˜ ìƒì„¸ (ë¶„ì„ í˜ì´ì§€ ì´ë™)

### ìŠ¤íƒ€ì¼
- `src/pages/ClaudeSessionAnalysisPage.module.css` - ë¶„ì„ í˜ì´ì§€ ìŠ¤íƒ€ì¼
- `src/pages/ClaudeSessionsListPage.module.css` - ë¶„ì„ ë²„íŠ¼ ìŠ¤íƒ€ì¼

## í…ŒìŠ¤íŠ¸

í•„í„°ë§ ë¡œì§ ê²€ì¦:

```bash
# Test script
node test-final.js
```

**ì˜ˆìƒ ê²°ê³¼**:
- ì „ì²´ ì´ë²¤íŠ¸: ~200ê°œ
- ì‚¬ìš©ì ì§ˆë¬¸: 2-3ê°œ (ì‹¤ì œ ì‚¬ìš©ì ì…ë ¥ë§Œ)
- tool_result, system messages ë“±ì€ ëª¨ë‘ ì œì™¸ë¨

## ë¬¸ì˜ ë° í”¼ë“œë°±

ê¸°ëŠ¥ ê°œì„  ì‚¬í•­ì´ë‚˜ ë²„ê·¸ ë¦¬í¬íŠ¸ëŠ” í”„ë¡œì íŠ¸ ì´ìŠˆ íŠ¸ë˜ì»¤ì— ë“±ë¡í•´ì£¼ì„¸ìš”.
